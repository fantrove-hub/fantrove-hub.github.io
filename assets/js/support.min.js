const paymentMethods = [
 {
  id: 'patreon',
  icon: {
   type: 'svg',
   content: `<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2"><g transform="matrix(.47407 0 0 .47407 .383 .422)"><clipPath id="prefix__a"><path d="M0 0h1080v1080H0z"/></clipPath><g clip-path="url(#prefix__a)"><path d="M1033.05 324.45c-.19-137.9-107.59-250.92-233.6-291.7-156.48-50.64-362.86-43.3-512.28 27.2-181.1 85.46-237.99 272.66-240.11 459.36-1.74 153.5 13.58 557.79 241.62 560.67 169.44 2.15 194.67-216.18 273.07-321.33 55.78-74.81 127.6-95.94 216.01-117.82 151.95-37.61 255.51-157.53 255.29-316.38z" fill-rule="nonzero"/></g></g></svg>`
  },
  name: 'patreon',
  supportType: 'รายเดือน',
  url: 'https://www.patreon.com/LedpAeroWings'
 },
 {
  id: 'truemoney',
  icon: {
   type: 'img',
   content: 'https://images.seeklogo.com/logo-png/36/1/truemoney-wallet-logo-png_seeklogo-367826.png',
   alt: 'truemoney logo'
  },
  name: 'TrueMoney',
  supportType: 'ครั้งเดียว',
  url: 'https://tmn.app.link/6oALhRsvQSb'
 }
 // ตัวอย่างการเพิ่มช่องทางใหม่ที่ใช้รูปภาพ
 // {
 //     id: 'new-method',
 //     icon: {
 //         type: 'img',
 //         content: 'path/to/image.png',
 //         alt: 'Description of image'
 //     },
 //     name: 'ชื่อช่องทาง',
 //     supportType: 'รายเดือน',
 //     url: 'https://example.com'
 // }
];

const pages = {
 'main': 'main-page',
 'confirm': 'confirmation-page',
 'payment': 'payment-methods-page',
 'thanks': 'thanks-page'
};

let selectedPaymentMethod = '';
let isAnimating = false;

function createPaymentOptions() {
 const container = document.querySelector('.payment-options');
 container.innerHTML = paymentMethods.map(method => `
        <div class="payment-option" onclick="selectPaymentMethod('${method.id}')">
            <span class="support-type">${method.supportType}</span>
            <span class="payment-icon">
                ${getIconHtml(method.icon)}
            </span>
            <span>${method.name}</span>
        </div>
    `).join('');
}

// เพิ่มฟังก์ชันสำหรับสร้าง HTML ของ icon ตามประเภท
function getIconHtml(icon) {
 switch (icon.type) {
  case 'svg':
   return icon.content;
  case 'img':
   return `<img src="${icon.content}" alt="${icon.alt || ''}" class="payment-img">`;
  case 'emoji':
   return icon.content;
  default:
   return '';
 }
}

function savePaymentMethod(method) {
 localStorage.setItem('selectedPaymentMethod', method);
}

function loadPaymentMethod() {
 return localStorage.getItem('selectedPaymentMethod') || '';
}

function updateURL(page) {
 const url = new URL(window.location);
 url.searchParams.set('page', page);
 window.history.pushState({ page }, '', url);
}

function showPageFromURL() {
 const urlParams = new URLSearchParams(window.location.search);
 const page = urlParams.get('page') || 'main';
 showPage(pages[page]);
 
 if (page === 'payment') {
  const savedMethod = loadPaymentMethod();
  if (savedMethod) {
   selectPaymentMethod(savedMethod, true);
  }
 }
}

function showPage(pageId) {
 document.querySelectorAll('.page').forEach(page => {
  page.classList.remove('active');
 });
 document.getElementById(pageId).classList.add('active');
}

function goBack() {
 window.history.back();
}

function showConfirmation() {
 updateURL('confirm');
 showPage('confirmation-page');
}

function showPaymentMethods() {
 updateURL('payment');
 showPage('payment-methods-page');
 
 const savedMethod = loadPaymentMethod();
 if (savedMethod) {
  selectPaymentMethod(savedMethod, true);
 }
}

function showThanks() {
 if (!selectedPaymentMethod) {
  alert('กรุณาเลือกช่องทางการสนับสนุน');
  return;
 }
 updateURL('thanks');
 showPage('thanks-page');
}

function selectPaymentMethod(method, isLoading = false) {
 selectedPaymentMethod = method;
 
 if (!isLoading) {
  savePaymentMethod(method);
 }
 
 document.querySelectorAll('.payment-option').forEach(option => {
  option.classList.remove('selected');
  if (option.querySelector('span:last-child').textContent ===
   paymentMethods.find(m => m.id === method)?.name) {
   option.classList.add('selected');
  }
 });
}

async function startRocketAnimation() {
 if (isAnimating) return;
 isAnimating = true;
 
 const overlay = document.getElementById('animation-overlay');
 const rocket = document.getElementById('rocket');
 
 overlay.classList.add('active');
 
 await new Promise(resolve => setTimeout(resolve, 500));
 
 rocket.style.visibility = 'visible';
 rocket.style.animation = 'rocketPath 2s cubic-bezier(0.4, 0, 0.2, 1) forwards';
 
 await new Promise(resolve => setTimeout(resolve, 2000));
 
 const selectedMethod = paymentMethods.find(m => m.id === selectedPaymentMethod);
 if (selectedMethod) {
  window.location.href = selectedMethod.url;
 }
}

window.addEventListener('popstate', (event) => {
 if (event.state && event.state.page) {
  showPage(pages[event.state.page]);
 } else {
  showPage(pages['main']);
 }
});

window.onload = () => {
 createPaymentOptions();
 showPageFromURL();
 if (!window.history.state) {
  window.history.replaceState({ page: 'main' }, '', window.location);
 }
};